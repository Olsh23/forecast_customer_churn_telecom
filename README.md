# Прогнозирование оттока клиентов

Оператор связи «ТелеДом» хочет бороться с оттоком клиентов. Для этого его сотрудники начнут предлагать промокоды и специальные условия всем, кто планирует отказаться от услуг связи. Чтобы заранее находить таких пользователей, «ТелеДому» нужна модель, которая будет предсказывать, разорвёт ли абонент договор. Команда оператора собрала персональные данные о некоторых клиентах, информацию об их тарифах и услугах. Задача — обучить на этих данных модель для прогноза оттока клиентов.

Для прогноза оттока клиентов предоставлены 4 таблицы данных с информацией о договорах, персональных данных клиентов, интернет-услугах и услугах телефонии. 

Все таблицы содержат данные, количество таблиц соответствует условию задачи.

- Таблица `contract` состоит из 8 колонок и 7043 строк
- Таблица `personal` состоит из 5 колонок и 7043 строк
- Таблица `internet` состоит из 8 колонок и 5517 строк
- Таблица `phone` состоит из 2 колонок и 6361 строки

Все таблицы можно соединить, используя идентификатор пользователя.

Так же в полученных данных отсутствовали явные пропуски и дубликаты.

Обзор уникальных значений выявил несколько моментов:
- в столбце `end_date` таблицы `contract` есть строковое значение `No`, скорее всего это означает, что действие договора еще не окончено - заменили такие значения на  дату `2020-02-01` (так как информация о договорах актуальна на 1 февраля 2020);
- значения в столбцах `monthly_charges` и `total_charges` таблицы `contract` строковые, хотя должны быть вещественные - значения-аномалии `' '` в столбце `total_charges` заменили на 0, так как отсутствие числового значения скорее всего связано с отсутствием оплат, далее оба столбца были приведены к типу `float`;
- значения столбца `senior_citizen` таблицы `personal` равны 0 и 1 - не как в других столбцах  `No` и `Yes` соответственно - привели к единому стилю со всеми столбцами.

При соединении таблиц образовались пропуски в столбцах, присоединенных из таблиц с инфориацией об интернете и телефонной связи. Так как люди могут пользоваться и телефоном, и интернетом вместе, могут не пользоваться ничем или чем-то одним, тут сложно угадать что именно скрывается за пропусками, заменили их на значение `NoInfo`.

Далее было создано 2 новые переменные из колонок `begin_date` и `end_date`:
- целевая переменная `is_active`;
- длительность контракта абонента в днях `duration_contract`.

После этого колонки `begin_date` и` end_date` были удалены.

При проверке данных на мультиколлинеарность выяснилось, что очень мало признаков имееют хоть какую-то зависимость с целевой переменной, если установить порог зависимости 0.30, то в итоговый набор данных войдут всего лишь 2 признака. При этом признки из таблицы `internet` сильно коррелируют между собой.

В итоге было решено оставить признаки, которые имеют корреляцию с целевым признаком 0.08 и выше, а так же те признаки, которые имеют межпризнаковую корреляцию нмже 0.75:
- duration_contract
- partner
- payment_method
- multiple_lines
- online_backup
- type
- senior_citizen
- paperless_billing

Во время исследовательского анализа оставшихся данных были выявлены следующие закономерности:
- В данных присутствует сильный дисбаланс классов, активных договоров почти в 5 раз больше, чем разорванных.
- Распределение длительности контракта активных договоров имеет пики в начале и в конце, распределение разорваных договоров похоже на низкий колокол, большинство разорваных договоров приходится по длительности контракта абонента в днях на значения около 500 и 1000 дней.
- Большинство клиентов не являются пенсионерами, как в активных договорах, так и в разорваных
- Среди клиентов, имеющих активный договор, больше неженатых и незамужних, а среди тех, кто разорвал договор, - наоборот - больше женатых и замужних.
- Больше всего абоненты предпочитают оплачивать услуги от месяца к месяцу, при этом доля разорвавших договор среди тех, кто оплачивает раз в год или два года, больше чем среди тех, кто платит помесячно.
- У большинства клиентов, как с активным договором, так и с закрытым, есть электронный расчетный лист.
- Среди абонентов больше тех, кто расплачивается с электронным чеком, при этом доля разорвавших договор среди тех, кто оплачивает автоматически, больше.
- У большинства клиентов активных договоров нет облачного хранилища файлов для резервного копирования данных. При этом доля клиентов разорвавших договоров среди тех, у кого есть хранилище, больше, чем среди тех, у кого нет.
- Большинство клиентов активных договоров не использует подключение телефона к нескольким линиям одновременно, большинство разорвавших договор - использует. Доля клиентов разорвавших договор среди тех, кто использует подключение к нескольким линиям, больше, чем среди тех, кто не использует.

В рамках подготовки к обучению моделей данные были разделены на тренировочную и тестовую выборки в соотношении 0.25, а так же отмасштабированы и кодированы.

По условию задачи было рассмотрено 3 вида моделей:

- случайный лес;
- бустинг `catboost`;
- нейронная сеть.

Качество моделей оценивалось на кросс-валидации метрикой `ROC-AUC`.

Все модели справились достаточно хорошо, лучший результат показала модель градиентного бустинга с метрикой `ROC-AUC = 0.92`. Ее использовали для тестирования.

На тестовой выборке удалось достичь требуемого значения ROC-AUC = 0.9265. Также доля правильных ответов тоже довольно высокая: accuracy = 0.8887.

Модель хорошо предсказывает истинно-положительные и истинно-ложные ответы, большинство ошибок заключается в излишнем предсказании ложно-отрицательных ответов.

Наиболее важным признаком оказалась длительность контракта абонента в днях - созданный признак.

В целом модель неплохо справляется со своей задачей.

Для улучшения работы модели можно рассмотреть следующие моменты:
- собрать больше данных и обучить модель на них;
- рассмотреть внедрение новых признаков, возможно не все учитывается во время сбора данных о клиентах;
- ввести корпоративную метрику качества, "бизнес-метрику", например финансовый ущерб от ухода клиента;
- оптимизировать хранение данных на основе выявленных проблем.